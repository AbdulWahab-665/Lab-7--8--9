<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lab 9 — To‑Do List (DOM & localStorage)</title>
  <style>
    :root{--accent:#0d6efd;--muted:#6b7280;--bg:#f7fafc}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;padding:24px;background:var(--bg);display:flex;justify-content:center}
    .app{width:100%;max-width:720px;background:white;border-radius:12px;padding:20px;box-shadow:0 8px 30px rgba(10,10,30,0.06)}
    h1{margin:0 0 12px;font-size:1.25rem}
    .meta{color:var(--muted);font-size:0.9rem;margin-bottom:16px}

    .controls{display:flex;gap:8px}
    .controls input[type="text"]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid #e5e7eb;font-size:0.95rem}
    .controls button{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer}
    .controls button:disabled{opacity:0.6;cursor:not-allowed}

    ul.list{list-style:none;margin:16px 0 0;padding:0}
    li.item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;border:1px solid #f1f5f9;margin-bottom:8px}
    li.item.completed{opacity:0.7;text-decoration:line-through;color:var(--muted)}

    .item .text{flex:1;min-width:0}
    .item .actions{display:flex;gap:8px}
    .btn{border:0;padding:6px 8px;border-radius:8px;background:#eef2ff;cursor:pointer;font-weight:600}
    .btn.danger{background:#ffecec}
    .small{font-size:0.85rem;padding:6px 8px}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    footer{margin-top:14px;color:var(--muted);font-size:0.9rem}

    /* responsive */
    @media (max-width:480px){.controls button{padding:10px 8px}}
  </style>
</head>
<body>
  <div class="app" id="app">
    <!-- README (short) -->
    <!--
      Lab 9 To-Do List
      - Features: add, edit, delete, toggle complete, persist to localStorage
      - Accessibility: Enter to add, Escape to cancel edit, focus management, ARIA labels
      - localStorage key: lab9_todos
      How to use:
      1. Type a task and press Enter or click Add.
      2. Click the checkbox to toggle complete.
      3. Click Edit to modify a task (press Enter or blur to save, Escape to cancel).
      4. Click Delete to remove a task.
    -->

    <h1>To‑Do List — Lab 9</h1>
    <div class="meta">Add tasks, edit, mark complete. State persists in <code>localStorage</code>.</div>

    <div class="controls" role="form" aria-label="Add new task">
      <label for="newTask" class="sr-only">New task</label>
      <input id="newTask" type="text" placeholder="Add a new task and press Enter" autocomplete="off">
      <button id="addBtn" aria-label="Add task">Add</button>
    </div>

    <ul id="todoList" class="list" aria-live="polite"></ul>

    <footer>
      <div id="count">0 tasks</div>
      <div style="margin-top:8px">
        <button id="clearCompleted" class="btn small" title="Remove completed tasks">Clear completed</button>
        <button id="clearAll" class="btn small danger" title="Remove all tasks">Clear all</button>
      </div>
    </footer>
  </div>

  <script>
    (function(){
      const STORAGE_KEY = 'lab9_todos'
      // DOM refs
      const input = document.getElementById('newTask')
      const addBtn = document.getElementById('addBtn')
      const list = document.getElementById('todoList')
      const countEl = document.getElementById('count')
      const clearCompletedBtn = document.getElementById('clearCompleted')
      const clearAllBtn = document.getElementById('clearAll')

      let todos = [] // {id, text, completed}

      // Utility: generate id
      function uid(){return Date.now().toString(36) + Math.random().toString(36).slice(2,6)}

      // Save & load
      function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(todos)) }
      function load(){ try { const raw = localStorage.getItem(STORAGE_KEY); todos = raw ? JSON.parse(raw) : []; } catch(e){ todos = [] } }

      // Render
      function render(){
        list.innerHTML = ''
        if(!todos.length){ list.innerHTML = '<li style="color:var(--muted);padding:12px;border-radius:8px;background:#fbfdff">Your list is empty — add a task above.</li>' }
        todos.forEach(todo => {
          const li = document.createElement('li')
          li.className = 'item' + (todo.completed ? ' completed' : '')
          li.dataset.id = todo.id

          // checkbox
          const cb = document.createElement('input')
          cb.type = 'checkbox'
          cb.checked = !!todo.completed
          cb.setAttribute('aria-label','Mark task as complete')
          cb.addEventListener('change', ()=> toggleComplete(todo.id))

          // text (or editable input)
          const txt = document.createElement('div')
          txt.className = 'text'
          txt.tabIndex = 0
          txt.textContent = todo.text
          txt.setAttribute('role','textbox')
          txt.setAttribute('aria-label','Task: '+todo.text)
          txt.addEventListener('dblclick', ()=> startEdit(todo.id))

          // actions
          const actions = document.createElement('div')
          actions.className = 'actions'

          const editBtn = document.createElement('button')
          editBtn.className = 'btn'
          editBtn.textContent = 'Edit'
          editBtn.setAttribute('aria-label','Edit task')
          editBtn.addEventListener('click', ()=> startEdit(todo.id))

          const delBtn = document.createElement('button')
          delBtn.className = 'btn danger'
          delBtn.textContent = 'Delete'
          delBtn.setAttribute('aria-label','Delete task')
          delBtn.addEventListener('click', ()=> removeTodo(todo.id))

          actions.append(editBtn, delBtn)
          li.append(cb, txt, actions)
          list.appendChild(li)
        })
        updateCount()
      }

      // Count
      function updateCount(){
        const total = todos.length
        const remaining = todos.filter(t=>!t.completed).length
        countEl.textContent = `${remaining} / ${total} remaining`
      }

      // Actions
      function addTodo(text){
        const trimmed = text.trim()
        if(!trimmed) return
        const todo = {id:uid(), text:trimmed, completed:false}
        todos.unshift(todo)
        save(); render();
      }

      function removeTodo(id){
        todos = todos.filter(t=>t.id!==id)
        save(); render();
      }

      function toggleComplete(id){
        const t = todos.find(x=>x.id===id)
        if(!t) return
        t.completed = !t.completed
        save(); render();
      }

      // Edit flow: replace text node with input
      function startEdit(id){
        const li = list.querySelector(`li[data-id="${id}"]`)
        if(!li) return
        const txtDiv = li.querySelector('.text')
        const old = txtDiv.textContent

        const input = document.createElement('input')
        input.type = 'text'
        input.value = old
        input.className = 'edit-input'
        input.style.width = '100%'
        input.style.padding = '8px'
        input.style.borderRadius = '6px'
        input.style.border = '1px solid #e5e7eb'

        // replace
        txtDiv.innerHTML = ''
        txtDiv.appendChild(input)
        input.focus()
        // place caret at end
        input.setSelectionRange(input.value.length, input.value.length)

        function finish(saveNew){
          const newVal = input.value.trim()
          if(saveNew && newVal){
            const t = todos.find(x=>x.id===id)
            if(t){ t.text = newVal }
          }
          render()
          removeListeners()
        }
        function onKey(e){
          if(e.key === 'Enter'){ finish(true) }
          else if(e.key === 'Escape'){ finish(false) }
        }
        function onBlur(){ finish(true) }
        function removeListeners(){ input.removeEventListener('keydown', onKey); input.removeEventListener('blur', onBlur) }

        input.addEventListener('keydown', onKey)
        input.addEventListener('blur', onBlur)
      }

      // Clear completed and clear all
      function clearCompleted(){ todos = todos.filter(t=>!t.completed); save(); render() }
      function clearAll(){ if(!confirm('Remove all tasks?')) return; todos = []; save(); render() }

      // Event wiring
      addBtn.addEventListener('click', ()=>{ addTodo(input.value); input.value=''; input.focus() })
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ addTodo(input.value); input.value=''; } })
      clearCompletedBtn.addEventListener('click', clearCompleted)
      clearAllBtn.addEventListener('click', clearAll)

      // Init
      function init(){ load(); render(); input.focus() }
      init()

      // Expose for debugging (optional)
      window.__lab9 = {getTodos: ()=>todos, save, load}
    })()
  </script>
</body>
</html>
